"use strict";(()=>{var g=Object.defineProperty;var m=Object.getOwnPropertySymbols;var C=Object.prototype.hasOwnProperty,y=Object.prototype.propertyIsEnumerable;var v=(o,t,e)=>t in o?g(o,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):o[t]=e,f=(o,t)=>{for(var e in t||(t={}))C.call(t,e)&&v(o,e,t[e]);if(m)for(var e of m(t))y.call(t,e)&&v(o,e,t[e]);return o};var c=(o,t,e)=>new Promise((s,n)=>{var i=a=>{try{l(e.next(a))}catch(p){n(p)}},r=a=>{try{l(e.throw(a))}catch(p){n(p)}},l=a=>a.done?s(a.value):Promise.resolve(a.value).then(i,r);l((e=e.apply(o,t)).next())});var h=class{constructor(t,e){this.cues=[];this.snapshotElement=null;this.rafPending=null;this.lastMouseEvent=null;this.player=t,this.options=e,this.initPromise=this.initialize()}ready(){return c(this,null,function*(){return this.initPromise})}get progressControl(){let t=this.player.controlBar||this.player.ControlBar;return t.progressControl||t.ProgressControl}initialize(){return c(this,null,function*(){try{let t=yield fetch(this.options.vttUrl);if(!t.ok)throw new Error(`Failed to load VTT file: ${t.statusText}`);let e=yield t.text();this.parseVTT(e),this.snapshotElement=document.createElement("div"),this.snapshotElement.className=this.options.snapshotClass||"vjs-vtt-snapshot",this.options.snapshotStyle&&Object.assign(this.snapshotElement.style,this.options.snapshotStyle);let s=this.player.el();if(!s)return;let n=document.createElement("style");n.textContent=`
        .video-js .vjs-progress-control .vjs-mouse-display .vjs-time-tooltip {
          bottom: -4em !important;
          top: auto !important;
        }
      `,s.appendChild(n),s.appendChild(this.snapshotElement),this.hideSnapshot(),this.initializeEventListeners()}catch(t){throw console.error("Error initializing VTT snapshot:",t),t}})}parseVTT(t){let e=t.split(`
`),s=null,n=1;for(;n<e.length;){let i=e[n].trim();if(i==="")s&&"startTime"in s&&"endTime"in s&&"text"in s&&this.cues.push(s),s=null;else if(i.includes("-->")){let[r,l]=i.split("-->").map(a=>this.parseTimestamp(a.trim()));s={startTime:r,endTime:l}}else s&&(s.text=i);n++}}parseTimestamp(t){let e=t.split(":"),s=parseFloat(e.pop()||"0"),n=parseInt(e.pop()||"0",10);return parseInt(e.pop()||"0",10)*3600+n*60+s}initializeEventListeners(){this.progressControl&&this.isValidProgressControl(this.progressControl)&&(this.progressControl.on("mousemove",this.handleMouseMove.bind(this)),this.progressControl.on("mouseleave",this.handleMouseLeave.bind(this)))}isValidProgressControl(t){let e=t.seekBar||t.SeekBar;return t&&typeof t.el=="function"&&typeof t.on=="function"&&e&&typeof e.calculateDistance=="function"}handleMouseMove(t){if(!this.progressControl||!this.isValidProgressControl(this.progressControl))return;let e=this.progressControl.el().getBoundingClientRect();this.lastMouseEvent={event:t,barRect:e},this.rafPending===null&&(this.rafPending=requestAnimationFrame(()=>this.updateSnapshot()))}updateSnapshot(){if(this.rafPending=null,!this.lastMouseEvent)return;let{event:t}=this.lastMouseEvent;if(!this.isValidProgressControl(this.progressControl))return;let e=this.progressControl.el().getBoundingClientRect(),n=(this.progressControl.seekBar||this.progressControl.SeekBar).calculateDistance(t),i=this.player.duration()*n,r=this.findClosestCue(i);if(r){let[l,a]=this.parseVttCue(r),p=f({time:i,src:l},a);if(this.options.beforeHovering){let d=this.options.beforeHovering(p);d&&(p=d)}this.showSnapshot(p,t,e),this.options.onHover&&this.options.onHover(p)}else this.hideSnapshot()}findClosestCue(t){if(!this.cues.length||!this.player.duration())return null;for(let i of this.cues)if(t>=i.startTime&&t<i.endTime)return i;let s=this.cues[0],n=Math.abs(t-(s.startTime+s.endTime)/2);for(let i=1;i<this.cues.length;i++){let r=this.cues[i],l=(r.startTime+r.endTime)/2,a=Math.abs(t-l);a<n&&(n=a,s=r)}return s}handleMouseLeave(){this.rafPending!==null&&(cancelAnimationFrame(this.rafPending),this.rafPending=null),this.lastMouseEvent=null,this.hideSnapshot(),this.options.onLeave&&this.options.onLeave()}parseVttCue(t){var i,r;let e=t.text.trim().split("#"),s=e[0],n=((r=(i=e[1])==null?void 0:i.split("=")[1])==null?void 0:r.split(",").map(Number))||[0,0,160,90];return[s,{x:n[0]||0,y:n[1]||0,w:n[2]||160,h:n[3]||90}]}showSnapshot(t,e,s){if(!this.snapshotElement)return;let n=this.player.el();if(!n)return;let i=n.getBoundingClientRect(),l=e.clientX-i.left-t.w/2;l=Math.max(0,Math.min(i.width-t.w,l)),Object.assign(this.snapshotElement.style,{display:"block",position:"absolute",left:`${l}px`,bottom:`${s.height+60}px`,width:`${t.w}px`,height:`${t.h}px`,backgroundImage:`url(${t.src})`,backgroundPosition:`-${t.x}px -${t.y}px`,backgroundRepeat:"no-repeat",backgroundSize:"auto"})}hideSnapshot(){this.snapshotElement&&(this.snapshotElement.style.display="none")}formatTime(t){let e=r=>r.toString().padStart(2,"0"),s=Math.floor(t/3600),n=Math.floor(t%3600/60),i=Math.floor(t%60);return s>0?`${e(s)}:${e(n)}:${e(i)}`:`${e(n)}:${e(i)}`}dispose(){this.snapshotElement&&this.snapshotElement.parentNode&&this.snapshotElement.parentNode.removeChild(this.snapshotElement)}};var u=class{constructor(t,e){this.instance=new h(t,e)}ready(){return this.instance.ready()}dispose(){this.instance&&this.instance.dispose()}};function S(o){return new u(this,o)}function T(o){var e;if(!o){console.warn("videojs-vtt-snapshot: No video.js instance provided");return}let t=o.registerPlugin||o.plugin;t&&!((e=o.getPlugin)!=null&&e.call(o,"vttSnapshot"))&&t("vttSnapshot",S)}typeof window!="undefined"&&window.videojs&&T(window.videojs);var M=u;})();
